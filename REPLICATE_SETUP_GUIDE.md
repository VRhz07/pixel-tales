# ğŸ¨ Replicate Image Generation Setup Guide

## Overview
This guide will help you set up **Replicate API** for high-quality AI image generation with **free credits** (no credit card required initially).

## Why Replicate?
âœ… **Free Credits** - Get started without payment  
âœ… **Multiple AI Models** - FLUX, Stable Diffusion, SDXL  
âœ… **High Quality** - Professional-grade image generation  
âœ… **Fast** - FLUX Schnell model generates in ~1-2 seconds  
âœ… **No Rate Limits** (on free tier with reasonable use)

---

## ğŸš€ Step 1: Get Your Replicate API Token

1. **Sign up** at [replicate.com](https://replicate.com)
   - Usually no credit card required for free tier
   - You'll get free credits to start

2. **Get your API token:**
   - Go to [replicate.com/account/api-tokens](https://replicate.com/account/api-tokens)
   - Click "Create token" or copy your existing token
   - It will look like: `r8_xxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

3. **Copy your token** - You'll need it in the next step

---

## ğŸ”§ Step 2: Backend Configuration

### Local Development

1. Open `backend/.env` (create it if it doesn't exist, use `.env.example` as template)

2. Add your Replicate API token:
```env
# Replicate API (for image generation)
REPLICATE_API_TOKEN=r8_your_token_here
```

3. Install the Replicate library:
```bash
cd backend
pip install replicate
```

### Production (Render.com)

1. Go to your Render dashboard
2. Navigate to your backend service
3. Go to **Environment** tab
4. Add a new environment variable:
   - **Key:** `REPLICATE_API_TOKEN`
   - **Value:** `r8_your_token_here`
5. Save and redeploy

---

## ğŸ¯ Step 3: Using Replicate in Your App

### Available Models

The integration supports these models:

| Model | Speed | Quality | Cost | Best For |
|-------|-------|---------|------|----------|
| **flux-schnell** | âš¡ Fast (1-2s) | Good | ğŸ†“ Free | Quick generations |
| **flux-dev** | Medium (3-5s) | Better | ğŸ’° Paid | Higher quality |
| **flux-pro** | Slow (10-15s) | Best | ğŸ’°ğŸ’° Paid | Professional |
| **stable-diffusion** | Medium | Good | ğŸ’° Paid | Classic SD |
| **sdxl** | Medium | Great | ğŸ’° Paid | SD XL quality |

**Recommendation:** Start with `flux-schnell` - it's **free and fast**!

---

## ğŸ’» Frontend Usage

### Option 1: Use the new Replicate function

```typescript
import { generateImageWithReplicate } from '@/services/imageGenerationService';

// Generate an image
const imageUrl = await generateImageWithReplicate({
  prompt: "a cute cartoon dragon in a magical forest",
  width: 1024,
  height: 1024,
  seed: 12345, // Optional: for reproducible results
});
```

### Option 2: Modify your existing code

Find where you're using `generateImage()` and you can switch to Replicate:

```typescript
// Before (Pollinations)
const imageUrl = await generateImage({
  prompt: myPrompt,
  width: 1024,
  height: 1024,
});

// After (Replicate)
const imageUrl = await generateImageWithReplicate({
  prompt: myPrompt,
  width: 1024,
  height: 1024,
});
```

---

## ğŸ§ª Testing

### Test the Backend Endpoint

```bash
# Make sure your backend is running
cd backend
python manage.py runserver

# In another terminal, test the endpoint
curl -X POST http://localhost:8000/api/ai/replicate/generate-image/ \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "a beautiful sunset over mountains",
    "model": "flux-schnell",
    "width": 1024,
    "height": 1024
  }'
```

### Test in Your Frontend

1. Open your app's console (F12)
2. Try generating an image
3. Look for these console messages:
   - `ğŸ¨ Generating image with Replicate (FLUX model)...`
   - `âœ… Image generated via Replicate backend proxy`

---

## ğŸ” Troubleshooting

### "Replicate library not installed"
```bash
cd backend
pip install replicate
# Then restart your backend server
```

### "REPLICATE_API_TOKEN not configured"
- Check your `.env` file has the token
- Make sure the token starts with `r8_`
- Restart your backend server after adding the token

### "No image generated by Replicate"
- Check your API token is valid
- Verify you have credits remaining at [replicate.com/account](https://replicate.com/account)
- Check backend console logs for detailed error messages

### Images not showing
- Check browser console for CORS errors
- Replicate returns direct image URLs - they should work without proxy
- Try opening the image URL directly in a new tab

---

## ğŸ’¡ Tips & Best Practices

### 1. **Start with Free Model**
Use `flux-schnell` for testing - it's fast and free!

### 2. **Monitor Your Credits**
Check your usage at [replicate.com/account](https://replicate.com/account)

### 3. **Use Seeds for Consistency**
Pass the same seed value to get similar results:
```typescript
const imageUrl = await generateImageWithReplicate({
  prompt: "dragon",
  seed: 42, // Same seed = similar results
});
```

### 4. **Optimize Prompts**
- Be specific: "cartoon dragon with blue scales" vs "dragon"
- Add style keywords: "digital art", "watercolor", "photorealistic"
- Specify composition: "close-up", "wide angle", "bird's eye view"

### 5. **Handle Errors Gracefully**
```typescript
try {
  const imageUrl = await generateImageWithReplicate(params);
  if (!imageUrl) {
    // Fallback to placeholder or Pollinations
    return '/placeholder.svg';
  }
  return imageUrl;
} catch (error) {
  console.error('Image generation failed:', error);
  // Show error to user or use fallback
}
```

---

## ğŸ¨ Example Prompts for Kids' Stories

```typescript
// Fantasy character
"cute friendly dragon with colorful scales, children's book illustration, 
soft lighting, magical forest background, digital art, vibrant colors"

// Adventure scene
"brave young explorer discovering ancient ruins, cartoon style, 
bright daylight, exciting atmosphere, storybook illustration"

// Magical landscape
"enchanted castle on floating islands, rainbow waterfalls, 
whimsical clouds, dreamy atmosphere, digital painting, 
children's fantasy art"
```

---

## ğŸ“Š Cost Comparison

| Service | Free Tier | Rate Limits | Quality | Speed |
|---------|-----------|-------------|---------|-------|
| **Replicate** | Free credits | Generous | â­â­â­â­â­ | Fast |
| **Pollinations** | Always free | None | â­â­â­â­ | Fast |
| **Gemini** | âŒ No image gen | N/A | N/A | N/A |

**Recommendation:** Use **Replicate for production** (higher quality) and keep **Pollinations as fallback**.

---

## ğŸ”„ Switching Between Services

You can easily switch between Replicate and Pollinations:

```typescript
// Try Replicate first
let imageUrl = await generateImageWithReplicate(params);

// Fallback to Pollinations if Replicate fails
if (!imageUrl) {
  console.log('Replicate failed, trying Pollinations...');
  imageUrl = await generateImage(params); // Pollinations
}

// Final fallback to placeholder
if (!imageUrl) {
  imageUrl = '/placeholder.svg';
}
```

---

## âœ… Quick Checklist

- [ ] Signed up at replicate.com
- [ ] Got API token from account page
- [ ] Added `REPLICATE_API_TOKEN` to `.env`
- [ ] Installed replicate library: `pip install replicate`
- [ ] Restarted backend server
- [ ] Tested image generation
- [ ] Checked credits at replicate.com/account

---

## ğŸ†˜ Need Help?

**Common Issues:**
1. **No credits?** Sign up for a new account or add payment method
2. **Slow generation?** Switch to `flux-schnell` model
3. **Poor quality?** Try `flux-dev` or improve your prompt
4. **Errors in console?** Check backend logs for details

**Resources:**
- [Replicate Documentation](https://replicate.com/docs)
- [FLUX Model Info](https://replicate.com/black-forest-labs/flux-schnell)
- [API Reference](https://replicate.com/docs/reference/http)

---

## ğŸ‰ You're All Set!

Your app now supports high-quality image generation with Replicate! 

**Next Steps:**
1. Test with different models to find your favorite
2. Optimize prompts for better results
3. Monitor your credit usage
4. Consider upgrading if you need more capacity

Happy generating! ğŸš€
