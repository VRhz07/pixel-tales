# üöÄ Pixel Tales Deployment Checklist

## Phase 1: Backend Deployment (Render.com)

### Step 1: Prepare Repository
- [ ] Commit all backend changes
- [ ] Make `build.sh` executable: `chmod +x backend/build.sh`
- [ ] Push to GitHub: `git push origin main`

### Step 2: Create Render Account
- [ ] Go to https://render.com
- [ ] Sign up with GitHub
- [ ] Authorize Render to access your repositories

### Step 3: Deploy Backend
- [ ] Click "New +" ‚Üí "Blueprint" (or "Web Service")
- [ ] Select your GitHub repository
- [ ] Render detects `render.yaml` automatically
- [ ] Click "Apply" or configure manually:
  - Name: `pixeltales-backend`
  - Region: Oregon (Free)
  - Branch: `main`
  - Root Directory: `backend`
  - Build Command: `./build.sh`
  - Start Command: `daphne -b 0.0.0.0 -p $PORT storybookapi.asgi:application`

### Step 4: Configure Environment Variables
Go to Service Settings ‚Üí Environment and add:

**Required:**
- [ ] `DEBUG=False`
- [ ] `SECRET_KEY=<auto-generated>`
- [ ] `ALLOWED_HOSTS=<your-app>.onrender.com`
- [ ] `GOOGLE_AI_API_KEY=<your-key>`
- [ ] `SENDGRID_API_KEY=<your-key>`
- [ ] `FROM_EMAIL=noreply@yourdomain.com`
- [ ] `DATABASE_URL=sqlite:///data/db.sqlite3`
- [ ] `RENDER=True`

**Optional:**
- [ ] `JWT_ACCESS_TOKEN_LIFETIME_DAYS=30`
- [ ] `JWT_REFRESH_TOKEN_LIFETIME_DAYS=365`

### Step 5: Add Persistent Disk (CRITICAL!)
- [ ] Go to Service ‚Üí Disks ‚Üí "Add Disk"
- [ ] Name: `pixeltales-data`
- [ ] Mount Path: `/opt/render/project/src/data`
- [ ] Size: 1 GB
- [ ] Save

### Step 6: Deploy & Monitor
- [ ] Watch build logs (5-10 minutes)
- [ ] Wait for "Live" status
- [ ] Note your URL: `https://<your-app>.onrender.com`

### Step 7: Create Admin User
- [ ] Open Render Shell (in dashboard)
- [ ] Run: `python manage.py createsuperuser`
- [ ] Follow prompts to create admin

### Step 8: Test Backend API
```bash
# Test health check
curl https://<your-app>.onrender.com/api/

# Test registration
curl https://<your-app>.onrender.com/api/auth/register/ \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@example.com","password":"testpass123"}'
```

- [ ] API responds successfully
- [ ] Admin panel accessible: `https://<your-app>.onrender.com/admin`

---

## Phase 2: Frontend Configuration

### Step 1: Update Environment Variables
Edit `frontend/.env`:
```env
# Replace with your Render URL
VITE_API_BASE_URL=https://<your-app>.onrender.com/api

# Keep existing keys
VITE_GEMINI_API_KEY=your-gemini-api-key-here
VITE_OCR_SPACE_API_KEY=your-ocr-api-key-here

# ‚ö†Ô∏è WARNING: These frontend keys are NO LONGER USED!
# API keys are now securely stored on the backend.
# See SECURITY_SETUP.md for details.
```

- [ ] Updated `VITE_API_BASE_URL`
- [ ] Saved changes

### Step 2: Test Frontend Locally
```bash
cd frontend
npm run dev
```

- [ ] Frontend connects to production backend
- [ ] Login/registration works
- [ ] API calls successful

---

## Phase 3: Mobile APK Build

### Step 1: Build Frontend for Production
```bash
cd frontend
npm run build
```

- [ ] Build completes without errors
- [ ] `frontend/dist` folder created

### Step 2: Update Capacitor Config
Verify `capacitor.config.ts` is correct:
```typescript
webDir: 'frontend/dist'
```

- [ ] Config verified

### Step 3: Sync with Capacitor
```bash
# From project root
npx cap sync android
```

- [ ] Sync completed successfully
- [ ] Android platform updated

### Step 4: Build APK
```bash
# Open Android Studio
npx cap open android

# Or build directly
cd android
./gradlew assembleDebug
```

- [ ] APK built successfully
- [ ] Location: `android/app/build/outputs/apk/debug/app-debug.apk`

### Step 5: Install on Device
```bash
# Via USB debugging
adb install android/app/build/outputs/apk/debug/app-debug.apk

# Or copy APK to phone and install manually
```

- [ ] APK installed on phone
- [ ] App launches successfully

---

## Phase 4: Testing on Mobile

### Functionality Tests
- [ ] User registration works
- [ ] Login/logout works
- [ ] Story creation works
- [ ] AI story generation works
- [ ] Canvas drawing works
- [ ] Image upload works
- [ ] Collaborative features work
- [ ] Notifications work
- [ ] Offline mode works

### Performance Tests
- [ ] App loads quickly
- [ ] Images load properly
- [ ] No crashes during normal use
- [ ] Battery usage acceptable

### Network Tests
- [ ] Works on WiFi
- [ ] Works on mobile data
- [ ] Handles offline gracefully
- [ ] Syncs when back online

---

## Phase 5: Post-Deployment

### Monitoring
- [ ] Check Render logs regularly
- [ ] Monitor API response times
- [ ] Track error rates
- [ ] Monitor disk usage

### Backup
- [ ] Set up regular database backups
- [ ] Document backup procedure
- [ ] Test restore process

### Security
- [ ] Change default admin password
- [ ] Review CORS settings
- [ ] Check SSL certificate
- [ ] Review API permissions

---

## üéâ Deployment Complete!

Your backend URL: `https://<your-app>.onrender.com`
Your APK location: `android/app/build/outputs/apk/debug/app-debug.apk`

### Next Steps:
1. Share APK with beta testers
2. Collect feedback
3. Monitor performance
4. Plan for scaling (PostgreSQL, paid hosting)

---

## Troubleshooting

### Backend Issues
- **Build fails**: Check `build.sh` permissions and logs
- **Database not persisting**: Verify disk is mounted
- **CORS errors**: Check `ALLOWED_HOSTS` and `CORS_ALLOWED_ORIGINS`
- **Slow cold starts**: Normal on free tier (15 min spin-down)

### APK Issues
- **App won't connect**: Verify `VITE_API_BASE_URL` is correct
- **API errors**: Check backend logs in Render
- **Images not loading**: Check MEDIA_ROOT settings
- **Crashes**: Check Android logcat: `adb logcat`

### Need Help?
- Backend logs: Render Dashboard ‚Üí Your Service ‚Üí Logs
- Frontend logs: Browser DevTools ‚Üí Console
- Android logs: `adb logcat | grep Pixel`
- Render docs: https://render.com/docs

---

**Total Time**: ~30 minutes
**Cost**: $0 (Free tier)
**Next Review**: After 100 users or 1 week
